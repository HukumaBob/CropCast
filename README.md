# CropCast

GUI приложение для кропа и конвертации видеофайлов и потоков с камер/устройств захвата с использованием FFmpeg.

## Возможности

- **Live preview** видео с интерактивными линиями кропа
- **Автоопределение** веб-камер и устройств захвата (Windows/Linux)
- **Выбор файлов** для обработки
- **Настройка кропа** через отдельные поля (сверху/снизу/слева/справа)
- **Экспорт в WebM** (VP9/VP8 + Opus/Vorbis) с seeking
- **Настройки кодирования**: quality (CRF), bitrate, выбор кодеков
- **Консоль FFmpeg** для просмотра прогресса конвертации
- **Автосохранение настроек** при закрытии приложения
- **Dark theme** для комфортной работы

## Требования

### Системные зависимости

- **Python 3.8+**
- **FFmpeg** (должен быть установлен и доступен в PATH)
  - Linux: `sudo apt install ffmpeg v4l-utils` (Ubuntu/Debian)
  - Windows: скачать с [ffmpeg.org](https://ffmpeg.org/download.html) и добавить в PATH

### Python зависимости

```bash
pip install -r requirements.txt
```

Или вручную:
```bash
pip install PyQt6 PyQt6-Multimedia
```

## Установка

1. Клонируйте репозиторий или скачайте файлы
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. Убедитесь что FFmpeg установлен:
   ```bash
   ffmpeg -version
   ```

## Запуск

```bash
python cropcast.py
```

Или сделайте файл исполняемым (Linux):
```bash
chmod +x cropcast.py
./cropcast.py
```

## Использование

### 1. Выбор источника видео

- **Файл**: нажмите "Browse File..." для выбора видеофайла
- **Устройство**: выберите камеру/устройство захвата из выпадающего списка

### 2. Настройка кропа

- Установите значения в полях **Crop Top/Bottom/Left/Right** (в пикселях)
- Красные линии на preview покажут область кропа
- Затемненные области будут удалены

### 3. Параметры кодирования

- **Video Codec**: VP9 (современный, лучшее сжатие) или VP8 (совместимость)
- **Audio Codec**: Opus (рекомендуется) или Vorbis
- **Quality (CRF)**: 0-63, где меньше = лучше качество (рекомендуется 23-30)
- **Bitrate**: 0 = авто (используется CRF), или укажите kbps вручную
- **Output Folder**: папка для сохранения результата

### 4. Конвертация

- Нажмите **Convert** для запуска
- Прогресс отображается в консоли FFmpeg внизу окна
- Результат сохраняется как `[имя_входного_файла]_cropped.webm`

### 5. Настройки

Следующие параметры сохраняются автоматически при закрытии:
- Значения кропа
- Последний источник видео
- Папка вывода
- Параметры качества и битрейта

Настройки хранятся в файле `cropcast_settings.json` в текущей директории.

## Горячие клавиши

- **Пробел**: Play/Pause (когда фокус на плеере)

## Особенности платформ

### Linux
- Использует V4L2 для захвата с камер
- Устройства определяются автоматически из `/dev/video*`
- Требуется пакет `v4l-utils` для определения имен устройств

### Windows
- Использует DirectShow для захвата
- Устройства определяются через FFmpeg `-list_devices`

## Известные ограничения

- Preview устройств захвата недоступен (только конвертация)
- Для устройств используйте кнопку Convert для проверки результата

## Устранение проблем

### Не отображаются устройства захвата

**Linux:**
```bash
# Проверьте доступные устройства
ls -l /dev/video*
# Установите права доступа
sudo usermod -a -G video $USER
```

**Windows:**
```bash
# Проверьте устройства через FFmpeg
ffmpeg -list_devices true -f dshow -i dummy
```

### FFmpeg не найден

Убедитесь что FFmpeg в PATH:
```bash
which ffmpeg  # Linux
where ffmpeg  # Windows
```

### Ошибки кодирования

- Проверьте что FFmpeg скомпилирован с поддержкой libvpx и libopus/libvorbis:
  ```bash
  ffmpeg -codecs | grep -E "vp8|vp9|opus|vorbis"
  ```

## Лицензия

MIT

## Автор

Created with Claude Code
